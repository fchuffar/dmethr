## Figure

```{r, fig.width=12, fig.height=8}
gses = c("GSE45332", "GSE5816")
models = c(model = "DNMT DKO vs. WT (ref.)", "5-aza 1000 nM vs. DMSO (ref.)")
gs_name = "methplusplus"
utests = list()

source("common.R")
layout(matrix(1:(3*length(gses)), length(gses), byrow=TRUE), respect=TRUE)
for (i in 1:length(gses)) {
  gse = gses[i]
  model = models[i]
  plot_volcano(feats, gse, gs_name, main=paste0(gse, " - ", model))
  if (i==1) {fig_label("A", cex=3)}

  gene_set = rownames(feats)[feats[[gs_name]]]
  expression_vector = feats[,paste0("l2fc_", gse)]
  names(expression_vector) = rownames(feats)
  expression_vector = expression_vector[!is.na(expression_vector)]

  utest = wilcox.test(expression_vector~ifelse(names(expression_vector)%in%gene_set, gs_name, "others"), las=2)
  utests[[i]] = utest
  boxplot(rank(expression_vector)~ifelse(names(expression_vector)%in%gene_set, gs_name, "others"), main=paste0("Mann-Whitney U test (pval=", signif(utest$p.value, 3), ")"), ylab=paste0("rank(log2FoldChange)"), xlab="", col=adjustcolor(c("red", "grey"), alpha.f=.5))  
  if (i==1) {fig_label("B", cex=3)}

  et_gsea_plot(expression_vector, gene_set, prefix=gs_name, nperm=3)  
  if (i==1) {fig_label("C", cex=3)}
}
```


In a demethylating context, *`r gs_name`* genes are particularly upregulated.
**(A)** The upper (resp. lower) volcano plot shows the results of the differential analysis of `r gses[1]` (resp. `r gses[2]`) data for the model `r models[1]` (resp. `r models[2]`). The x-axis the represents the `log2FoldChange` of the model and the y-axis the the $-log10(pval_{Fisher})$. Red dots are the *`r gs_name`* genes.
**(B)** The upper (resp. lower) boxplots shows the distribution of genes ranks obtained from `log2FoldChange` for the *`r gs_name`* in `r gses[1]` (resp. `r gses[2]`) dataset. The *`r gs_name`* genes are in red and the other genes are in grey. We perform the Mann-Whitney U test and conclude for `r gses[1]` (resp. `r gses[2]`) that *`r gs_name`* genes are particularly over expressed in the model `r model` with a significant pvalue of $`r signif(utests[[1]]$p.value, 3)`$ (resp. $`r signif(utests[[1]]$p.value, 3)`$).
**(C)** The enrichement plots are obtained using GSEA software. Both illustrate that over expressed genes in `r model[1]` and `r model[2]` are enriched in *`r gs_name`* genes.
